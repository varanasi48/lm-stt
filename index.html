<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Azure Static Web App - Speech & OCR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.1/docx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .tab { display: none; }
        .active { display: block; }
        .tab-buttons button { margin: 10px; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>Azure Static Web App - Speech & OCR</h1>
    
    <!-- Navigation Tabs -->
    <div class="tab-buttons">
        <button onclick="showTab('speechTab')">ðŸŽ¤ Speech-to-Text</button>
        <button onclick="showTab('ocrTab')">ðŸ“· OCR (Image to Text)</button>
    </div>

    <!-- Speech-to-Text Tab -->
    <div id="speechTab" class="tab active">
        <h2>Speech-to-Text</h2>
        <button id="startSpeech">ðŸŽ¤ Start Speech</button>
        <button id="endSpeech" style="display: none;">ðŸ›‘ End Speech</button>
        <textarea id="speechText" rows="5" cols="50" placeholder="Speech will appear here..."></textarea>
        <br><br>
        <button id="downloadSpeechDoc">ðŸ“„ Download as DOCX</button>
    </div>

    <script>
        // Tab Switching Function
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        // Speech-to-Text with End Button
        const startSpeechButton = document.getElementById("startSpeech");
        const endSpeechButton = document.getElementById("endSpeech");
        const speechText = document.getElementById("speechText");
        const downloadSpeechDocButton = document.getElementById("downloadSpeechDoc");

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        let finalTranscript = "";

        if (!SpeechRecognition) {
            alert("Your browser does not support Speech Recognition.");
        } else {
            recognition = new SpeechRecognition();
            recognition.lang = "en-US";
            recognition.continuous = true;
            recognition.interimResults = true;

            startSpeechButton.addEventListener("click", () => {
                finalTranscript = "";
                recognition.start();
                startSpeechButton.style.display = "none";
                endSpeechButton.style.display = "inline";
            });

            recognition.onresult = (event) => {
                let interimTranscript = "";
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript + "\n";
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                speechText.value = finalTranscript + interimTranscript;
            };

            endSpeechButton.addEventListener("click", () => {
                recognition.stop();
                startSpeechButton.style.display = "inline";
                endSpeechButton.style.display = "none";
                speechText.value = formatAsBulletPoints(finalTranscript);
            });
        }

        // Format speech text as bullet points
        function formatAsBulletPoints(text) {
            return text.split("\n").filter(line => line.trim() !== "").map(line => "â€¢ " + line.trim()).join("\n");
        }

        // Generate DOCX File
        function downloadDoc(textAreaId, fileName) {
            const { Document, Packer, Paragraph } = docx;
            const textContent = document.getElementById(textAreaId).value || "No text provided.";
            const doc = new Document({
                sections: [{ children: textContent.split("\n").map(line => new Paragraph(line)) }],
            });

            Packer.toBlob(doc).then(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = fileName;
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        downloadSpeechDocButton.addEventListener("click", () => downloadDoc("speechText", "speech-text.docx"));
    </script>

</body>
</html>
