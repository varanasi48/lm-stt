<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Azure Static Web App - Speech & OCR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.1/docx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .tab { display: none; }
        .active { display: block; }
        .tab-buttons button { margin: 10px; padding: 10px; cursor: pointer; }
        video, canvas { width: 100%; max-width: 400px; display: none; }
    </style>
</head>
<body>

    <h1>Azure Static Web App - Speech & OCR</h1>
    
    <!-- Navigation Tabs -->
    <div class="tab-buttons">
        <button onclick="showTab('speechTab')">ğŸ¤ Speech-to-Text</button>
        <button onclick="showTab('ocrTab')">ğŸ“· OCR (Image to Text)</button>
    </div>

    <!-- Speech-to-Text Tab -->
    <div id="speechTab" class="tab active">
        <h2>Speech-to-Text</h2>
        <button id="startSpeech">ğŸ¤ Start Speech</button>
        <textarea id="speechText" rows="5" cols="50" placeholder="Speech will appear here..."></textarea>
        <br><br>
        <button id="downloadSpeechDoc">ğŸ“„ Download as DOCX</button>
    </div>

    <!-- OCR Tab -->
    <div id="ocrTab" class="tab">
        <h2>OCR - Extract Text from Image</h2>
        
        <button onclick="chooseImageSource()">ğŸ“· Use Camera / ğŸ“ Upload Image</button>
        
        <input type="file" id="imageInput" accept="image/*" style="display: none;">
        <video id="video" autoplay></video>
        <canvas id="canvas"></canvas>
        <button id="captureButton" style="display: none;">ğŸ“¸ Capture</button>

        <br><br>
        <button id="startOCR">ğŸ” Start OCR</button>
        <textarea id="ocrText" rows="5" cols="50" placeholder="Extracted text will appear here..."></textarea>
        <br><br>
        <button id="downloadOCRDoc">ğŸ“„ Download OCR Text as DOCX</button>
    </div>

    <script>
        // Tab Switching Function
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        // Speech-to-Text
        const startSpeechButton = document.getElementById("startSpeech");
        const speechText = document.getElementById("speechText");
        const downloadSpeechDocButton = document.getElementById("downloadSpeechDoc");

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            alert("Your browser does not support Speech Recognition.");
        } else {
            const recognition = new SpeechRecognition();
            recognition.lang = "en-US";
            
            startSpeechButton.addEventListener("click", () => {
                recognition.start();
                startSpeechButton.innerText = "ğŸ¤ Listening...";
            });

            recognition.onresult = (event) => {
                speechText.value = event.results[0][0].transcript;
            };

            recognition.onspeechend = () => {
                recognition.stop();
                startSpeechButton.innerText = "ğŸ¤ Start Speech";
            };
        }

        // OCR Functionality
        const imageInput = document.getElementById("imageInput");
        const video = document.getElementById("video");
        const canvas = document.getElementById("canvas");
        const captureButton = document.getElementById("captureButton");
        let useCamera = false;

        function chooseImageSource() {
            const choice = confirm("Press OK to use Camera, Cancel to Upload an Image.");
            if (choice) {
                startCamera();
            } else {
                imageInput.click();
            }
        }

        function startCamera() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    video.style.display = "block";
                    captureButton.style.display = "block";
                    video.srcObject = stream;
                    useCamera = true;
                })
                .catch(err => alert("Camera access denied: " + err));
        }

        captureButton.addEventListener("click", () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0);
            video.srcObject.getTracks().forEach(track => track.stop());
            video.style.display = "none";
            captureButton.style.display = "none";
            useCamera = false;
        });

        document.getElementById("startOCR").addEventListener("click", () => {
            if (useCamera) {
                processImage(canvas.toDataURL());
            } else {
                const file = imageInput.files[0];
                if (!file) {
                    alert("Please select an image first!");
                    return;
                }
                const reader = new FileReader();
                reader.onload = () => processImage(reader.result);
                reader.readAsDataURL(file);
            }
        });

        function processImage(imageSrc) {
            Tesseract.recognize(imageSrc, 'eng')
                .then(({ data: { text } }) => {
                    document.getElementById("ocrText").value = text;
                })
                .catch(error => alert("OCR Error: " + error));
        }

        // Download DOCX Function
        function downloadDoc(textAreaId, fileName) {
            const { Document, Packer, Paragraph } = docx;
            const textContent = document.getElementById(textAreaId).value || "No text provided.";
            const doc = new Document({
                sections: [{ children: [new Paragraph(textContent)] }],
            });

            Packer.toBlob(doc).then(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = fileName;
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        downloadSpeechDocButton.addEventListener("click", () => downloadDoc("speechText", "speech-text.docx"));
        document.getElementById("downloadOCRDoc").addEventListener("click", () => downloadDoc("ocrText", "ocr-text.docx"));
    </script>

</body>
</html>
